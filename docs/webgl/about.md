# 关于 WebGL

WebGL（Web 图形库）是一个 **JavaScript API**[[MDN]](https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API)，可在任何兼容的 Web 浏览器中渲染高性能的交互式 **3D 和 2D 图形**，而无需使用插件。

`WebGL API` 可以让开发者使用 JavaScript 语言直接和显卡（GPU）通信。

`GLSL`英文全称是 OpenGL Shading Language（OpenGL 着色语言）,是 WebGL 的 GPU 部分的编程语言，用来编写运行在 GPU 上的着色器程序。

着色器程序需要接收 CPU（WebGL 使用 JavaScript） 传递过来的数据，然后对这些数据进行流水线处理，最终显示在屏幕上，进而实现丰富多彩的 3D 应用。

`WebGL`按照流水线的方式将 3D 模型数据渲染到 2D 屏幕上的，业界把这种渲染方式称为**图形管线**或者**渲染管线**。

## WebGL 工作原理

WebGL 只能够绘制**点**、**线段**、**三角形**这三种基本图元。那些复杂的立方体、球体、圆柱体等模型本质上是由一个一个的**点**组成，GPU 将这些点用**三角形图元**绘制成一个个的微小平面，这些平面之间互相连接，从而组成各种各样的立体模型。

因此，首要任务是创建组成这些模型的顶点数据。

一般情况，最初的顶点坐标是位于**模型中心**，不能直接传递到着色器中，需要对定点坐标执行**模型转换**、**视图转换**、**投影转换**，转换后的坐标才是 WebGL 可接受的坐标，即**裁剪空间坐标**。把最终的**变换矩阵**和**原始顶点坐标**传递给 GPU，GPU 的**渲染管线**对它们执行流水线作业。

GPU **渲染管线**的主要处理过程如下：

1. 首先进入顶点着色器阶段，利用 GPU 的并行计算优势对顶点逐个进行坐标变换。
2. 然后进入图元装配阶段，将顶点按照图元类型组装成图形。
3. 接下来来到光栅化阶段，光栅化阶段将图形用不包含颜色信息的像素填充。
4. 在之后进入片元着色器阶段，该阶段为像素着色，并最终显示在屏幕上。

<image-box src="http://assets.yomuki.com/md/GPU%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF.png" />

## 相关术语

相关术语：

- 图元：WebGL 可绘制的基本图形元素：点、线段、三角形
- 片元：可理解为像素，像素着色阶段是在片元着色器中
- 裁剪坐标系：是**顶点着色器**中的 `gl_Position` 内置变量接收到的坐标所在的坐标系。
- 设备坐标系（NDC 坐标系）：是裁剪坐标系各个分量对 w 分量相除得到的坐标系，特点是 x、y、z 坐标分量的取值范围都在 【-1，1】之间，可以将它理解为边长为 2 的正方体，坐标系原点在正方体中心。
